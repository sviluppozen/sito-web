---
import { getCollection } from "astro:content";
import type { AstroSeoProps } from "@astrolib/seo";
import MarkdownPostLayout from "@layouts/MarkdownPostLayout.astro";
import { useTranslatedPath } from "@i18n/utils";

export async function getStaticPaths() {
	const blogEntries = await getCollection("posts");
	return blogEntries
		.filter((entry) => entry.slug.startsWith("en/"))
		.map((entry) => ({
			params: { slug: entry.slug.substring(3) }, // Remove 'en/' prefix
			props: { entry, lang: "en" },
		}));
}

const { entry, lang } = Astro.props;
const { Content } = await entry.render();
const translatePath = useTranslatedPath(lang);

const seo: AstroSeoProps = {
	title: entry.data.title,
	description: entry.data.description,
	canonical: `https://sviluppozen.it${translatePath(`/blog/${entry.slug.substring(3)}`)}`,
	openGraph: {
		url: entry.slug,
		title: entry.data.title,
		description: "{frontmatter.description}",
		images: [
			{
				url: "https://sviluppozen.it/opengraph/social-og.jpg",
				width: 1200,
				height: 630,
				alt: "Social open graph",
				type: "image/jpeg",
			},
			{
				url: "https://sviluppozen.it/opengraph/twitter-og.jpg",
				width: 4096,
				height: 4096,
				alt: "Twitter open graph",
				type: "image/jpeg",
			},
			{ url: "https://sviluppozen.it/opengraph/social-og.jpg" },
			{ url: "https://sviluppozen.it/opengraph/twitter-og.jpg" },
		],
		site_name: "SviluppoZen",
	},
	twitter: {
		handle: "@sviluppozen",
		site: "@sviluppozen",
		cardType: "summary_large_image",
	},
};
---

<MarkdownPostLayout frontmatter={entry.data} body={entry.body} seo={seo}>
	<Content />
</MarkdownPostLayout>
