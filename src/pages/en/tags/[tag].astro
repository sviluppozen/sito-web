---
import { getCollection } from "astro:content";
import type { AstroSeoProps } from "@astrolib/seo";
import Tag from "@/components/blog/Tag.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";

export async function getStaticPaths() {
	const allPosts = await getCollection("posts", ({ slug }) => slug.startsWith('en/'));
	const uniqueTags = [...new Set(allPosts.flatMap((post) => post.data.tags))];
	return uniqueTags.map((tag) => ({
		params: { tag },
	}));
}

const { tag } = Astro.params;
const allPosts = await getCollection("posts", ({ slug }) => slug.startsWith('en/'));
const posts = allPosts
	.filter((post) => post.data.tags.includes(tag))
	.map((post) => ({
		...post,
		slug: post.slug.slice(3),
	}));

const seo: AstroSeoProps = {
	title: `${tag} | SviluppoZen`,
	description: `Explore articles and insights on '${tag}' at SviluppoZen. Dive into a wealth of knowledge covering the latest trends and tips in web design and SEO.`,
	canonical: `https://sviluppozen.it/en/tags/${tag}/`,
};
---

<BaseLayout seo={seo}>
	<Tag tag={tag} posts={posts} />
</BaseLayout>
