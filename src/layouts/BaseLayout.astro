---
import BlobCursorFollower from "@/components/global/BlobCursorFollower.astro";
import CookieConsent from "@/components/global/CookieConsent.astro";
import { AstroSeo, type AstroSeoProps } from "@astrolib/seo";
import BaseHead from "@components/BaseHead.astro";
import BackgroundTexture from "@components/global/BackgroundTexture.astro";
import Footer from "@components/global/Footer.astro";
import Navigation from "@components/global/Navigation.astro";
import { ui } from "@i18n/ui";
import { getLangFromUrl } from "../i18n/utils";
import "../styles/global.css";


const { pathname } = Astro.url;

type Props = {
	seo?: AstroSeoProps;
};

const { seo: seoProp } = Astro.props;

const lang = getLangFromUrl(Astro.url);

const shareImage = new URL("/images/meta/sviluppozen_share.png", Astro.site).toString();

const defaultSeo: AstroSeoProps = {
	title: ui[lang]["seo.title.default"] || "SviluppoZen: Sviluppo Siti Web e App a Firenze",
	description: ui[lang]["seo.description.default"] || "Agenzia di sviluppo web a Firenze specializzata in siti web custom, applicazioni web e hosting gestito. Soluzioni performanti per la crescita del tuo business.",
	canonical: Astro.url.href,
	openGraph: {
		url: Astro.url.href,
		title: ui[lang]["seo.title.default"] || "SviluppoZen: Sviluppo Siti Web e App a Firenze",
		description: ui[lang]["seo.description.default"] || "Agenzia di sviluppo web a Firenze specializzata in siti web custom, applicazioni web e hosting gestito.",
		images: [
			{
				url: shareImage,
				width: 1200,
				height: 630,
				alt: "SviluppoZen Logo",
				type: "image/png",
			},
			{
				url: shareImage,
				width: 4096,
				height: 4096,
				alt: "Twitter open graph",
				type: "image/png",
			},
		],
		site_name: "SviluppoZen",
	},
	twitter: {
		handle: "", // Replace with your actual Twitter handle
		site: "", // Replace with your actual Twitter handle
		cardType: "summary_large_image",
	},
	additionalMetaTags: [
		{
			name: "publisher",
			content: "SviluppoZen di Giuseppe Rossi",
		},
	],
};

const seo = {
	...defaultSeo,
	...seoProp,
};

function cursorFollowerActive() {
	const paths = ["", "/", "/it/", "/it"];
	return paths.includes(pathname);
}
---

<html lang={lang}>
	<head>
		<BaseHead />
		<AstroSeo {...seo} />{
			import.meta.env.PROD &&
				<script is:inline>
					function loadGtm() {
						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer','GTM-NSKM8LKT');
						console.log("Google Tag Manager loaded.");
					}

					if (localStorage.getItem("cookie_consent") === "true") {
						loadGtm();
					} else {
						window.addEventListener("consent-given", loadGtm, { once: true });
					}
				</script>
		}
	</head>
	<body class="bg-white">
		<BackgroundTexture />
		<Navigation />
		{cursorFollowerActive() && <BlobCursorFollower />}
		<slot />
		<Footer />
		<CookieConsent />
	</body>
</html>
